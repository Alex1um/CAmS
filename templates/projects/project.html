{% extends "bars.html" %}
{% block main %}
    {% load static %}
    <link rel="stylesheet" type="text/css"
          href="{% static 'css/projects/project-group.min.css' %}">
    <link rel="stylesheet" type="text/css"
          href="{% static 'css/projects/project.min.css' %}">
    <link rel="stylesheet" type="text/css"
          href="{% static 'css/projects/file-dir.min.css' %}">
    <link rel="stylesheet" type="text/css"
          href="{% static 'css/bootstrap.min.css' %}">
    <link rel="stylesheet" type="text/css"
          href="{% static 'css/bootstrap-theme.min.css' %}">
    <link rel="stylesheet" type="text/css"
          href="{% static 'css/projects/project-edit.min.css' %}">
    {% if mode == "edit" %}
        <form method="post" id="global-edit-form">
        {% csrf_token %}
    {% endif %}
    <section class="main-grid">
        {% if owner %}
        <nav id="nav-block">
            {% if mode == "edit" %}
                <input type="submit" class="btn btn-primary" value="Save">
                <a href="/p/{{ project.id }}" class="btn btn-info">Cancel</a>
                <a href="/p/delete/{{ project.id }}" class="btn btn-danger">Delete</a>
            {% else %}
                <a href="/p/edit/{{ project.id }}" class="btn btn-warning">Edit</a>
                <label for="global-middle-project-choose" class="btn btn-success">Add to</label>
            {% endif %}
        </nav>
        {% endif %}
        <header>
            {% if mode == "edit" %}
                <label for="project-name">Project name</label>
                <h1><input id="project-name" name="name" maxlength="100" type="text" value="{{ project.name }}" required></h1>
                <hr>
                <label for="project-description">Description</label>
                <p><textarea name="description" id="project-description">{{ project.description }}</textarea></p>
                <hr>
                <label for="project-short-description">Short description</label>
                <p><textarea name="short_description" id="project-short-description">{{ project.short_description }}</textarea></p>
            {% else %}
                <h1>{{ project.name }}</h1>
                {% if project.description %}
                    <hr>
                    <p>{{ project.description }}</p>
                {% endif %}
            {% endif %}
        </header>
        <section class="main-content">
            {% autoescape off %}
                {% if mode == "edit" %}
{#                    {% load markdown_to_html %}#}
{#                    <span name="home_markdown" id="project-markdown" role="textbox" contenteditable>#}
{#                        {{ project.home_markdown|markdown_split }}#}
{#                    </span>#}
                    <label for="markdown-form">Markdown description</label>
                    <textarea name="home_markdown" id="markdown-form" aria-multiline="true">{{ project.home_markdown }}</textarea>
                {% else %}
                    {{ project.home_html }}
                {% endif %}
            {% endautoescape %}
        </section>
        <section class="main-tab-block">
            <aside></aside>
            <input type="radio" id="main-tab-dependencies" name="main-tab-switcher" checked>
            <label for="main-tab-dependencies">Dependencies</label>
            <input type="radio" id="main-tab-dependent" name="main-tab-switcher">
            <label for="main-tab-dependent">Dependent Projects</label>
            <input type="radio" id="main-tab-files" name="main-tab-switcher">
            <label for="main-tab-files">Files</label>
            <aside></aside>
            <section class="main-tab-content">
                {% if owner %}
                    <div id="main-dependencies">
                        <nav id="main-dependencies-navbar">
                            {% include "projects/project-group.html" with projects=dependencies %}
                        </nav>
                    </div>
                    <div id="main-dependent">
                        <nav id="main-dependent-navbar">
                            {% include "projects/project-group.html" with projects=dependent %}
                        </nav>
                    </div>
                    <div id="main-files">
                        <nav id="main-files-navbar">
                            <a class="btn btn-info">Edit</a>
                        </nav>
                        {% include "projects/file-dir.html" with mode=mode %}
                    </div>
                {% else %}
                    <div id="main-dependencies">
                        {% include "projects/project-group.html" with projects=dependencies %}
                    </div>
                    <div id="main-dependent">
                        {% include "projects/project-group.html" with projects=dependent %}
                    </div>
                    <div id="main-files">
                        {% include "projects/file-dir.html" with mode=mode %}
                    </div>
                    {% endif %}
            </section>
        </section>
    </section>

    {% if mode == "edit" %}
        </form>
    {% endif %}
{% endblock %}
{% block global_middle_menu %}
    {% load static %}
    <link rel="stylesheet" type="text/css"
          href="{% static 'css/projects/project-chooser.min.css' %}">
    <input type="checkbox" id="global-middle-project-choose">
    <div class="global-middle-project-chooser">
        <form method="post" action="/p/mkdep/{{ project.id }}" class="form-control">
            {% csrf_token %}
            <label for="global-middle-project-choose" class="close badge project-chooser-close" aria-label="Close">&times;</label>
            <h4>Выберите проекты:</h4>
            {% include "projects/project-group.html" with projects=owner_projects info="True" %}
            <input type="submit" class="btn">
        </form>
    </div>
    {% if mode == "edit" %}
        <input type="checkbox" id="global-middle-version-chooser">
        <div>

        </div>
    {% endif %}
{% endblock %}